(function(e){"use strict";tinymce.create("tinymce.plugins.IconizePlugin",{init:function(t,n){var r=this;var i;t.on("BeforeExecCommand",function(n){var r=n.command,i=t.selection.getNode(),s=t.dom.getParent(i,"A"),o=t.dom.getParent(i,"span.iconized-stack"),u,a;if("WP_Link"===r){if(t.dom.hasClass(i,"iconized")){u=o?o:i;s=t.dom.getParent(i,"A");if(!s){e(u).wrap('<a href="http://">')}t.selection.select(u);t.selection.collapse(0)}}else if("unlink"===r){if((t.dom.getParent(i,".iconized")||o)&&s){a=t.selection.getBookmark();t.dom.remove(s,1);t.selection.moveToBookmark(a)}}});e("#wp-link").on("visibility",function(){var n=e(this);var r=setInterval(function(){if(n.is(":hidden")){var e=t.selection.getNode(),r=t.dom.getParent(e,"A"),i;if(null!==r&&(!t.dom.getAttrib(r,"href")||"http://"===t.dom.getAttrib(r,"href"))){i=t.selection.getBookmark();t.dom.remove(r,1);t.selection.moveToBookmark(i);t.focus()}}},300)}).trigger("visibility");t.on("init",function(){t.on("mousedown",function(n){var i=t.getBody();if(t.dom.hasClass(n.target,"iconized")||t.dom.hasClass(n.target,"iconized-placeholder")){if(tinymce.Env.ie){e(i).attr({contenteditable:false})}n.preventDefault();n.stopPropagation();r._selectIcon(t,n.target);t.focus();return false}else{if(tinymce.Env.ie){e(i).attr({contenteditable:true})}}});t.on("mouseup",function(n){if(tinymce.Env.ie){var r=t.getBody();if((t.dom.hasClass(n.target,"iconized")||t.dom.hasClass(n.target,"iconized-placeholder"))&&t.dom.getParent(n.target,"A")){e(r).attr({contenteditable:true})}}});t.on("keydown",function(n){var r,i,s,o,u,a=t.getBody(),f="ï»¿";r=n.keyCode?n.keyCode:n.which;if(!n.metaKey||!n.ctrlKey||!(r>=112&&r<=123)||8!==r||46!==r){i=t.selection.getNode();if(t.dom.hasClass(i,"iconized")){if(tinymce.Env.ie){e(a).attr({contenteditable:true})}n.preventDefault();s=t.dom.getParent(i,"span.iconized-stack");o=s?s:i;u=t.dom.create("span",{"class":"iconize-cph","data-mce-bogus":"true"},f);if(37===r||38===r){o.parentNode.insertBefore(u,o)}else{t.dom.insertAfter(u,o)}t.selection.setCursorLocation(u,0);t.selection.collapse(1);t.dom.remove(u);return false}}})});t.addCommand("insertIcon",function(){if((!i||!i.disabled())&&typeof window.iconizeTinymceDialog!=="undefined"){window.iconizeTinymceDialog.open(t.id)}});t.addCommand("swapIconsPositions",function(){var e=t.selection.getNode(),n=t.dom.getPrev(e,".iconized"),r=t.dom.getNext(e,".iconized");if(n){t.dom.insertAfter(n,e);t.selection.select(n)}else if(r){e.parentNode.insertBefore(r,e);t.selection.select(r)}});t.addCommand("swapIconsSizes",function(){var e=t.selection.getNode(),n=t.dom.getPrev(e,".iconized"),r=t.dom.getNext(e,".iconized"),i=n||r,s="iconized-stack-base";if(i){if(t.dom.hasClass(i,s)){t.dom.removeClass(i,s);t.dom.addClass(e,s)}else if(t.dom.hasClass(e,s)){t.dom.removeClass(e,s);t.dom.addClass(i,s)}}});t.addCommand("removeIcon",function(){var n,r,i,s,o,u,a,f=t.selection.getNode(),l=t.dom.hasClass(f,"iconized"),c=t.dom.getParent(f,"span.iconized-stack"),h="",p=iconizeTinymceDialog.getSelectOptions(e("#mce-icon-size")),d=iconizeTinymceDialog.getSelectOptions(e("#mce-icon-align"));if(l){if(c){n=t.dom.getAttrib(c,"class");r=n.split(/ /);for(var v=0;v<r.length;v++){if(e.inArray(r[v],p)!==-1){u=r[v]}if(e.inArray(r[v],d)!==-1){a=r[v]}}i=t.dom.getPrev(f,".iconized");s=t.dom.getNext(f,".iconized");o=i||s;if(o){if(t.dom.hasClass(o,"iconized-stack-base")){t.dom.removeClass(o,"iconized-stack-base")}if(u){t.dom.addClass(o,u)}if(a){t.dom.addClass(o,a)}h=o.outerHTML}t.dom.remove(c);t.execCommand("mceInsertContent",false,h)}else{t.dom.remove(f)}t.nodeChanged()}});t.addButton("insert_icon",{title:t.getLang("iconize_mce.insert_icon_title"),cmd:"insertIcon",image:n+"/images/flag.png",onPostRender:function(){var e=this;t.on("NodeChange",function(n){var r=n.element;e.active(t.dom.getParent(r,".iconized")&&!t.selection.isCollapsed())})}});t.addButton("swap_icon_positions",{title:t.getLang("iconize_mce.swap_pos_title"),cmd:"swapIconsPositions",image:n+"/images/swappos.png",onPostRender:function(){var e=this;t.on("NodeChange",function(n){var r=n.element;e.disabled(!(t.dom.getParent(r,".iconized")&&t.dom.getParent(r,".iconized-stack")&&(t.dom.getPrev(r,".iconized")||t.dom.getPrev(r.parentNode,".iconized")||t.dom.getNext(r,".iconized")||t.dom.getNext(r.parentNode,".iconized"))))})}});t.addButton("swap_icon_sizes",{title:t.getLang("iconize_mce.swap_size_title"),cmd:"swapIconsSizes",image:n+"/images/swapsizes.png",onPostRender:function(){var e=this;t.on("NodeChange",function(n){var r=n.element;e.disabled(!(t.dom.getParent(r,".iconized")&&t.dom.getParent(r,".iconized-stack")&&(t.dom.getPrev(r,".iconized")||t.dom.getPrev(r.parentNode,".iconized")||t.dom.getNext(r,".iconized")||t.dom.getNext(r.parentNode,".iconized"))))})}});t.addButton("remove_icon",{title:t.getLang("iconize_mce.remove_icon_title"),cmd:"removeIcon",image:n+"/images/unflag.png",onPostRender:function(){var e=this;t.on("NodeChange",function(n){var r=n.element;e.disabled(!(t.dom.getParent(r,".iconized")&&!t.selection.isCollapsed()))})}});r._handlePlaceholder(t);t.on("NodeChange",function(e){var n=e.element;if("SPAN"===n.nodeName&&t.dom.hasClass(n,"iconized-placeholder")){r._selectIcon(t,n)}})},getInfo:function(){return{longname:"Iconize WordPress Plugin",author:"Mladen Ivancevic",authorurl:"http://codecanyon.net/user/mladen16/",infourl:"http://codecanyon.net/user/mladen16/",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_selectIcon:function(t,n){if(t.dom.hasClass(n,"iconized-placeholder")){if(tinymce.Env.webkit){e(n.parentNode).removeAttr("contenteditable");t.selection.select(n.parentNode);e(n.parentNode).attr({contenteditable:false})}else{t.selection.select(n.parentNode)}}else{t.selection.select(n)}},_handlePlaceholder:function(t){t.on("ResolveName",function(e){var n=t.dom,r=e.target;if(t.dom.hasClass(r,"iconized")){e.name=t.selection.isCollapsed()?"placeholder":"iconized"}else if(t.dom.hasClass(r,"iconized-stack")){e.name=t.selection.isCollapsed()?"placeholder":"iconized-stack"}});t.on("BeforeSetContent",function(t){if(t.content){var n=e("<div></div>");n.html(t.content);e(n).find(".iconized").each(function(){var t=e(this);if(t.parent(".iconized-stack")){t.parent(".iconized-stack").attr({contenteditable:"false","data-mce-resize":"false"});t.empty().attr("data-mce-resize","false").removeClass("mceItemNoResize").append('<span class="iconized-placeholder" data-mce-resize="false">|icon|</span>')}else{t.empty().attr("contenteditable","false").removeClass("mceItemNoResize").append('<span class="iconized-placeholder" data-mce-resize="false">|icon|</span>')}});var r=e(n).html();t.content=r;e(n).remove()}});t.on("PostProcess",function(t){if(t.get){var n=e("<div></div>");n.html(t.content);e(n).find(".iconized").each(function(){var t=e(this);if(t.parent(".iconized-stack")){t.parent(".iconized-stack").removeAttr("contenteditable").removeAttr("data-mce-resize").removeClass("mceItemNoResize")}t.empty().removeAttr("contenteditable").removeAttr("data-mce-resize").removeClass("mceItemNoResize")});var r=e(n).html();t.content=r;e(n).remove()}})}});tinymce.PluginManager.add("iconize_mce",tinymce.plugins.IconizePlugin)})(jQuery);