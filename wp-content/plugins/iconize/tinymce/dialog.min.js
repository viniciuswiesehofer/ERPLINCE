var iconizeTinymceDialog;(function(e){"use strict";var t,n,r,i,s,o,u,a,f,l={},c=[],h="",p=[],d="",v=[],m=[],g=[],y=[],b=[],w=[],E=[],S=[],x=[],T=[],N=["iconized","iconized-stack-base"],C=["iconized-stack"],k="hover-color-change";iconizeTinymceDialog={textarea:"",init:function(){l.dialog=e("#iconize-mce-modal");l.submit=e("#iconize-mce-update");l.stack=e("#iconize-mce-stack");l.set=e("#mce-icon-set");l.name=e("#mce-icon-name");l.effect=e("#mce-icon-effect");l.transform=e("#mce-icon-transform");l.animate=e("#mce-icon-animate");l.hover=e("#mce-icon-hover");l.color=e("#mce-icon-color");l.hovercolor=e("#mce-icon-color-hover");l.size=e("#mce-icon-size");l.customsize=e("#mce-icon-custom-size");l.align=e("#mce-icon-align");l.custom=e("#mce-icon-custom-classes");s=e("#iconize-mce-icons");o=e("#iconize-mce-title");u=e("#mce-icon-size-howto");a=e("#mce-icon-align-howto");f=e("#mce-color-hover-checkbox");y=iconizeTinymceDialog.getSelectOptions(l.set);S=iconizeTinymceDialog.getSelectOptions(l.transform);x=iconizeTinymceDialog.getSelectOptions(l.animate);T=iconizeTinymceDialog.getSelectOptions(l.hover);w=iconizeTinymceDialog.getSelectOptions(l.size);E=iconizeTinymceDialog.getSelectOptions(l.align);g=iconizeTinymceDialog.getSelectOptions(l.effect);if(iconizeDialogParams.icons){for(var t=0;t<y.length;t++){var n=y[t],r=iconizeDialogParams.icons[n],i=e('<ul id="'+n+'-icons-list">').addClass("icons-list");s.append(i);e.merge(m,r);for(var h=0;h<r.length;h++){var p=r[h],d="glyph-"+p,v;v='<li class="icons-list-item">';v+='<a href="#" class="icons-list-icon" title="'+p+'" data-set="'+n+'">';v+='<span class="iconized '+n+" "+d+'"></span>';v+="</a>";v+="</li>";i.append(v);c.push({label:p,set:n});b.push(d)}}}C.push(k);e.merge(C,N);e.merge(C,b);e.merge(C,y);e.merge(C,S);e.merge(C,x);e.merge(C,T);e.merge(C,w);e.merge(C,E);l.set.change(function(){var t=e(this).val(),n="#"+t+"-icons-list";s.find(".icons-list").hide();s.find(n).show();s.scrollTop(0)});l.name.iconizeautocomplete({appendTo:l.dialog,source:c,minLength:1,change:function(t,n){if(null===n.item){var r=s.find(".selected-icon"),i=r.attr("title"),o=r.data("set");if(r.length){e(this).val(i);l.set.val(o)}else{e(this).val("");l.set.val(y[0])}}},select:function(e,t){iconizeTinymceDialog.unselectIcon();iconizeTinymceDialog.selectIcon(t.item.set,t.item.value);iconizeTinymceDialog.scrollToIcon()}}).bind("focus",function(){e(this).iconizeautocomplete("search")});l.color.wpColorPicker({change:function(){iconizeTinymceDialog.setColor(e(this).wpColorPicker("color"));f.removeClass("hidden")},clear:function(){iconizeTinymceDialog.setColor("");f.addClass("hidden")}});l.custom.tagit({autocomplete:{disabled:true},preprocessTag:function(e){if(!e){return""}var t=e.replace(/^[^-_a-zA-Z]+/,"").replace(/^-(?:[-0-9]+)/,"-");var n=t&&t.replace(/[^-_a-zA-Z0-9]+/g,"-");return n},afterTagAdded:function(t,n){if(e.inArray(n.tagLabel,C)!==-1){alert(iconizeDialogParams.l10n.reserved_class);l.custom.tagit("removeTag",n.tag)}}});l.submit.click(function(e){e.preventDefault();iconizeTinymceDialog.update()});l.stack.click(function(e){e.preventDefault();iconizeTinymceDialog.stack()});e("#iconize-mce-modal .icons-list-icon").click(function(t){t.preventDefault();var n=e(this);if(false===n.hasClass("selected-icon")){s.find(".icons-list-icon.selected-icon").removeClass("selected-icon");n.addClass("selected-icon");l.name.val(n.attr("title"))}});l.dialog.on("show.wpbs.modal",iconizeTinymceDialog.refresh);l.dialog.on("shown.wpbs.modal",function(){iconizeTinymceDialog.scrollToIcon(true)});l.dialog.on("hide.wpbs.modal",iconizeTinymceDialog.onClose);l.dialog.on("hidden.wpbs.modal",iconizeTinymceDialog.setDefaultValues);if(typeof wp!=="undefined"&&wp.editor&&wp.editor.fullscreen){wp.editor.fullscreen.insertIcon=function(){if(iconizeTinymceDialog.isMCE()){tinyMCE.execCommand("insertIcon")}else{iconizeTinymceDialog.open()}}}if(iconizeSettings.iconizeQuicktags&&typeof QTags!=="undefined"){QTags.addButton("icon","icon",function(){iconizeTinymceDialog.open()},"","",iconizeDialogParams.l10n.insert,130)}},isMCE:function(){if("wp_mce_fullscreen"===wpActiveEditor){return e("#wp-fullscreen-mode-bar").hasClass("wp-tmce-mode")}else{return t&&!t.isHidden()}},open:function(n){var r;iconizeTinymceDialog.range=null;if(n){window.wpActiveEditor=n}if(!window.wpActiveEditor){return}iconizeTinymceDialog.textarea=e("#"+window.wpActiveEditor).get(0);if(typeof tinymce!=="undefined"){r=tinymce.get(wpActiveEditor);if(r&&!r.isHidden()){t=r}else{t=null}if(t&&tinymce.Env.ie){t.windowManager.bookmark=t.selection.getBookmark()}}if(!iconizeTinymceDialog.isMCE()&&document.selection){iconizeTinymceDialog.textarea.focus();iconizeTinymceDialog.range=document.selection.createRange()}l.dialog.wpbsmodal("show")},refresh:function(){if(!b.length){alert(iconizeDialogParams.l10n.no_icons_defined);return false}s.addClass("loading-overlay");if(iconizeTinymceDialog.isMCE()){if(tinymce.Env.ie){t.selection.moveToBookmark(t.windowManager.bookmark)}iconizeTinymceDialog.mceRefresh()}else{iconizeTinymceDialog.range=null;if(document.selection){iconizeTinymceDialog.textarea.focus();iconizeTinymceDialog.range=document.selection.createRange()}iconizeTinymceDialog.setDefaultValues()}},mceRefresh:function(){var n,s,c,m="",C="",L="",A="",O="",M="",_="",D="",P="",H="",B="",j="",F=false;c=t;m=c.selection.getNode();r=c.dom.hasClass(m,"iconized");i=c.dom.getParent(m,"span.iconized-stack");if(r){o.text(iconizeDialogParams.l10n.edit);if(i){l.stack.hide();u.text(iconizeDialogParams.l10n.stack_size_label);a.text(iconizeDialogParams.l10n.stack_align_label);d=c.dom.getAttrib(i,"class");v=d.split(/ /);for(n=0;n<v.length;n++){if(e.inArray(v[n],w)!==-1){O=v[n]}if(e.inArray(v[n],E)!==-1){_=v[n]}}if(c.dom.getStyle(i,"font-size")){M=c.dom.getStyle(i,"font-size")}}else{l.stack.show();u.text(iconizeDialogParams.l10n.icon_size_label);a.text(iconizeDialogParams.l10n.icon_align_label)}h=c.dom.getAttrib(m,"class");p=h.split(/ /);for(n=0;n<N.length;n++){s=e.inArray(N[n],p);if(s!==-1){p.splice(s,1)}}for(n=0;n<p.length;n++){if(e.inArray(p[n],y)!==-1){C=p[n]}else if(e.inArray(p[n],b)!==-1){L=p[n]}else if(!i&&e.inArray(p[n],w)!==-1){O=p[n]}else if(!i&&e.inArray(p[n],E)!==-1){_=p[n]}else if(e.inArray(p[n],S)!==-1){P=p[n];D="transform"}else if(e.inArray(p[n],x)!==-1){H=p[n];D="animate"}else if(e.inArray(p[n],T)!==-1){B=p[n];D="hover"}else if(k===p[n]){F=true}else{l.custom.tagit("createTag",p[n])}}if(L&&C){A=L.replace("glyph-","");iconizeTinymceDialog.selectIcon(C,A);l.transform.val(P);l.animate.val(H);l.hover.val(B);if(D){l.effect.val(D)}else{l.effect.val(g[0])}iconizeTinymceDialog.showChildOptions(l.effect);if(c.dom.getStyle(m,"font-size")){M=c.dom.getStyle(m,"font-size")}if(M){l.size.val("custom-size");l.customsize.val(M)}else{l.size.val(O);l.customsize.val("")}iconizeTinymceDialog.showChildOptions(l.size);l.align.val(_);if(c.dom.getStyle(m,"color")){j=c.dom.getStyle(m,"color");f.removeClass("hidden")}else{j="";f.addClass("hidden")}l.color.val(j);l.color.wpColorPicker("color",j);l.hovercolor.prop("checked",F);l.submit.text(iconizeDialogParams.l10n.update)}else{alert(iconizeDialogParams.l10n.no_icon_found);iconizeTinymceDialog.setDefaultValues()}}else{iconizeTinymceDialog.setDefaultValues()}},close:function(){l.dialog.wpbsmodal("hide")},onClose:function(){if(!iconizeTinymceDialog.isMCE()){if(iconizeTinymceDialog.range){iconizeTinymceDialog.range.moveToBookmark(iconizeTinymceDialog.range.getBookmark());iconizeTinymceDialog.range.select()}}},update:function(){if(iconizeTinymceDialog.isMCE()){iconizeTinymceDialog.mceUpdate()}else{iconizeTinymceDialog.htmlUpdate()}},htmlUpdate:function(){var e,t,n,r=iconizeTinymceDialog.textarea,i="",s="",o="",u="",a="",f="",c="",h="",p="",d="",v="",m="";if(!r){return}s=l.name.val();if(!s){alert(iconizeDialogParams.l10n.no_icon_selected)}else{i=l.set.val();o=l.size.val();u=l.customsize.val();a=l.align.val();f=l.effect.val();h=l.color.val();p=l.hovercolor.prop("checked");d=l.custom.tagit("assignedTags");d=d.toString();d=d.replace(/,/g," ");if("transform"===f){c=l.transform.val()}else if("animate"===f){c=l.animate.val()}else if("hover"===f){c=l.hover.val()}if(h||"custom-size"===o){m=' style="';m+=h?"color:"+h+";":"";m+=u?"font-size:"+u+";":"";m+='"'}v='<span class="iconized '+i+" glyph-"+s;v+=o&&"custom-size"!==o?" "+o:"";v+=a?" "+a:"";v+=c?" "+c:"";v+=h&&p?" "+k:"";v+=d?" "+d:"";v+='"';v+=m;v+="></span>";if(document.selection&&iconizeTinymceDialog.range){r.focus();iconizeTinymceDialog.range.text=v;iconizeTinymceDialog.range.moveToBookmark(iconizeTinymceDialog.range.getBookmark());iconizeTinymceDialog.range.select();iconizeTinymceDialog.range=null}else if(typeof r.selectionStart!=="undefined"){e=r.selectionStart;t=r.selectionEnd;n=e+v.length;r.value=r.value.substring(0,e)+v+r.value.substring(t,r.value.length);r.selectionStart=r.selectionEnd=n}r.focus();iconizeTinymceDialog.close()}},mceUpdate:function(){var s,o,u,a=[],f="",c="",m="",g="",y="",b="",S="",x="",T="",C="",L="",A="";u=t;if(tinymce.Env.ie){u.selection.moveToBookmark(u.updatedSelectionBookmark)}c=l.name.val();if(!c){alert(iconizeDialogParams.l10n.no_icon_selected)}else{f=l.set.val();m=l.size.val();g=l.customsize.val();y=l.align.val();b=l.effect.val();x=l.color.val();T=l.hovercolor.prop("checked");C=l.custom.tagit("assignedTags");C=C.toString();C=C.replace(/,/g," ");if("transform"===b){S=l.transform.val()}else if("animate"===b){S=l.animate.val()}else if("hover"===b){S=l.hover.val()}n=u.selection.getNode();r=u.dom.hasClass(n,"iconized");i=u.dom.getParent(n,"span.iconized-stack");h=u.dom.getAttrib(n,"class");p=h.split(/ /);for(s=0;s<N.length;s++){o=e.inArray(N[s],p);if(o!==-1){a.push(N[s])}}if(r){if(i){d=u.dom.getAttrib(i,"class");v=d.split(/ /);for(s=0;s<v.length;s++){if(e.inArray(v[s],w)!==-1){u.dom.removeClass(i,v[s])}else if(e.inArray(v[s],E)!==-1){u.dom.removeClass(i,v[s])}}e(i).removeAttr("data-mce-style")}e(n).removeAttr("class");e(n).removeAttr("data-mce-style");for(s=0;s<a.length;s++){u.dom.addClass(n,a[s])}u.dom.addClass(n,f);u.dom.addClass(n,"glyph-"+c);if(i){if("custom-size"===m){u.dom.setStyles(i,{"font-size":g})}else{u.dom.setStyles(i,{"font-size":""});u.dom.addClass(i,m)}if(y){u.dom.addClass(i,y)}}else{if("custom-size"===m){u.dom.setStyles(n,{"font-size":g})}else{u.dom.setStyles(n,{"font-size":""});u.dom.addClass(n,m)}if(y){u.dom.addClass(n,y)}}if(S){u.dom.addClass(n,S)}if(C){u.dom.addClass(n,C)}if(x&&T){u.dom.addClass(n,k)}u.dom.setStyles(n,{color:x})}else{A="iconized "+f+" glyph-"+c;A+=m&&"custom-size"!==m?" "+m:"";A+=y?" "+y:"";A+=S?" "+S:"";A+=C?" "+C:"";L=u.dom.create("span",{"class":A,contenteditable:"false","data-mce-resize":"false"},'<span class="iconized-placeholder" data-mce-resize="false">|icon|</span>');if("custom-size"===m){u.dom.setStyle(L,"font-size",g)}if(x){u.dom.setStyle(L,"color",x);if(T){u.dom.addClass(L,k)}}u.selection.setNode(L)}u.focus();iconizeTinymceDialog.close()}},stack:function(){var r,i,s="",o="",u="",a="",f="",c="",d="",v="",m="",g="",y="",b="",S="",x="";i=t;s=l.set.val();o=l.name.val();u=l.size.val();a=l.customsize.val();f=l.align.val();c=l.effect.val();v=l.color.val();m=l.hovercolor.prop("checked");g=l.custom.tagit("assignedTags");g=g.toString();g=g.replace(/,/g," ");if("transform"===c){d=l.transform.val()}else if("animate"===c){d=l.animate.val()}else if("hover"===c){d=l.hover.val()}n=i.selection.getNode();h=i.dom.getAttrib(n,"class");p=h.split(/ /);for(r=0;r<p.length;r++){if(e.inArray(p[r],w)!==-1){i.dom.removeClass(n,p[r])}else if(e.inArray(p[r],E)!==-1){i.dom.removeClass(n,p[r])}if(i.dom.getStyle(n,"font-size")){S=i.dom.getStyle(n,"font-size")}}i.dom.addClass(n,"iconized-stack-base");b='<span contenteditable="false" class="iconized-stack';b+=u&&"custom-size"!==u?" "+u:"";b+=f?" "+f:"";b+='"/>';e(n).wrap(b).parent().css("font-size",S);x="iconized "+s+" glyph-"+o;x+=d?" "+d:"";x+=g?" "+g:"";y=i.dom.create("span",{"class":x,contenteditable:"false","data-mce-resize":"false"},'<span class="iconized-placeholder" data-mce-resize="false">|icon|</span>');if(v){i.dom.setStyle(y,"color",v);if(m){i.dom.addClass(y,k)}}i.dom.insertAfter(y,n);i.selection.setCursorLocation(y,0);i.focus();iconizeTinymceDialog.close()},setDefaultValues:function(){iconizeTinymceDialog.unselectIcon();iconizeTinymceDialog.clearColorPicker();iconizeTinymceDialog.clearCustomClasses();l.stack.hide();l.effect.val(g[0]);l.transform.val("");l.animate.val("");l.hover.val("");iconizeTinymceDialog.showChildOptions(l.effect);l.size.val("");l.customsize.val("");iconizeTinymceDialog.showChildOptions(l.size);l.align.val("");l.color.val("");l.hovercolor.prop("checked",false);f.addClass("hidden");o.text(iconizeDialogParams.l10n.insert);u.text(iconizeDialogParams.l10n.icon_size_label);a.text(iconizeDialogParams.l10n.icon_align_label);l.submit.text(iconizeDialogParams.l10n.insert)},selectIcon:function(e,t){l.set.val(e);s.find(".icons-list").hide();s.find("#"+e+"-icons-list").show();var n="."+e+".glyph-"+t;s.find(n).parent().addClass("selected-icon");l.name.val(t)},unselectIcon:function(){s.find(".icons-list-icon.selected-icon").removeClass("selected-icon");l.name.val("");l.set.val(y[0]);s.find(".icons-list").hide();s.find("#"+y[0]+"-icons-list").show()},setColor:function(e){l.color.val(e)},clearColorPicker:function(){l.color.wpColorPicker("color","");e("#iconize-mce-modal .wp-color-result").removeAttr("style")},clearCustomClasses:function(){l.custom.tagit("removeAll")},scrollToIcon:function(e){var t=e||false,n="",r=0;n=l.dialog.find(".selected-icon");if(n.length){r=n.position().top-s.position().top+s.scrollTop()-92}if(true===t){s.animate({scrollTop:r},"500","swing",function(){s.removeClass("loading-overlay")})}else{s.scrollTop(r)}},getSelectOptions:function(t){var n=[];t.find("option").each(function(){var t=e(this).val();n.push(t)});return n},showChildOptions:function(t){var n=t,r=n.val(),i=n.attr("id"),s=".mother-opt-"+i,o=".mother-val-"+r;e(s).addClass("hidden");e(s+o).removeClass("hidden")}};e(document).ready(iconizeTinymceDialog.init)})(jQuery);