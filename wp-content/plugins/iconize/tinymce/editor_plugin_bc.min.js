(function(e){"use strict";tinymce.create("tinymce.plugins.IconizePlugin",{init:function(t,n){var r=this;t.onEvent.add(function(e,t){if(tinymce.isIE){e.updatedSelectionBookmark=e.selection.getBookmark(1);if(e.dom.hasClass(t.target,"iconized-stack")){t.target.oncontrolselect=function(){return false}}}if(tinymce.isGecko){e.settings.object_resizing=false}});t.onBeforeExecCommand.add(function(t,n){var r=t.selection.getNode(),i=t.dom.getParent(r,"A"),s=t.dom.getParent(r,"span.iconized-stack"),o,u;if("WP_Link"===n){if(t.dom.hasClass(r,"iconized")){o=s?s:r;i=t.dom.getParent(r,"A");if(!i){e(o).wrap('<a href="http://">')}t.selection.select(o);t.selection.collapse(0)}}else if("unlink"===n){if((t.dom.getParent(r,".iconized")||s)&&i){u=t.selection.getBookmark();t.dom.remove(i,1);t.selection.moveToBookmark(u)}}});e("#wp-link").on("wpdialogclose",function(e,n){tinyMCEPopup.restoreSelection();var r=t.selection.getNode(),i=t.dom.getParent(r,"A"),s;if(null!==i&&(!t.dom.getAttrib(i,"href")||"http://"===t.dom.getAttrib(i,"href"))){s=t.selection.getBookmark();t.dom.remove(i,1);t.selection.moveToBookmark(s);t.focus()}});t.onInit.add(function(){t.dom.events.add(t.getBody(),"mousedown",function(n){var i=t.getBody();if(t.dom.hasClass(n.target,"iconized")||t.dom.hasClass(n.target,"iconized-placeholder")){if(tinymce.isIE){e(i).attr({contenteditable:false})}n.preventDefault();n.stopPropagation();r._selectIcon(t,n.target);t.focus();return false}else{if(tinymce.isIE){e(i).attr({contenteditable:true})}}});t.dom.events.add(t.getBody(),"mouseup",function(n){if(tinymce.isIE){var r=t.getBody();if((t.dom.hasClass(n.target,"iconized")||t.dom.hasClass(n.target,"iconized-placeholder"))&&t.dom.getParent(n.target,"A")){e(r).attr({contenteditable:true})}}});t.dom.events.add(t.getBody(),"keydown",function(n){var r,i,s,o,u,a=t.getBody(),f="ï»¿";r=n.keyCode?n.keyCode:n.which;if(!n.metaKey||!n.ctrlKey||!(r>=112&&r<=123)||8!==r||46!==r){i=t.selection.getNode();if(t.dom.hasClass(i,"iconized")){if(tinymce.isIE){e(a).attr({contenteditable:true})}n.preventDefault();s=t.dom.getParent(i,"span.iconized-stack");o=s?s:i;u=t.dom.create("span",{"class":"iconize-cph","data-mce-bogus":"true"},f);if(37===r||38===r){o.parentNode.insertBefore(u,o)}else{t.dom.insertAfter(u,o)}t.selection.setCursorLocation(u,0);t.selection.collapse(1);t.dom.remove(u);return false}}})});t.addCommand("insertIcon",function(){t.windowManager.open({id:"iconize-mce-modal",bmDialog:true,inline:1},{plugin_url:n})});t.addCommand("swapIconsPositions",function(){var e=t.selection.getNode(),n=t.dom.getPrev(e,".iconized"),r=t.dom.getNext(e,".iconized");if(n){t.dom.insertAfter(n,e);t.selection.select(n)}else if(r){e.parentNode.insertBefore(r,e);t.selection.select(r)}});t.addCommand("swapIconsSizes",function(){var e=t.selection.getNode(),n=t.dom.getPrev(e,".iconized"),r=t.dom.getNext(e,".iconized"),i=n||r,s="iconized-stack-base";if(i){if(t.dom.hasClass(i,s)){t.dom.removeClass(i,s);t.dom.addClass(e,s)}else if(t.dom.hasClass(e,s)){t.dom.removeClass(e,s);t.dom.addClass(i,s)}}});t.addCommand("removeIcon",function(){var n,r,i,s,o,u,a,f=t.selection.getNode(),l=t.dom.hasClass(f,"iconized"),c=t.dom.getParent(f,"span.iconized-stack"),h="",p=iconizeTinymceDialog.getSelectOptions(e("#mce-icon-size")),d=iconizeTinymceDialog.getSelectOptions(e("#mce-icon-align"));if(l){if(c){n=t.dom.getAttrib(c,"class");r=n.split(/ /);for(var v=0;v<r.length;v++){if(e.inArray(r[v],p)!==-1){u=r[v]}if(e.inArray(r[v],d)!==-1){a=r[v]}}i=t.dom.getPrev(f,".iconized");s=t.dom.getNext(f,".iconized");o=i||s;if(o){if(t.dom.hasClass(o,"iconized-stack-base")){t.dom.removeClass(o,"iconized-stack-base")}if(u){t.dom.addClass(o,u)}if(a){t.dom.addClass(o,a)}h=o.outerHTML}t.dom.remove(c);t.execCommand("mceInsertContent",false,h)}else{t.dom.remove(f)}t.nodeChanged()}});t.addButton("insert_icon",{title:t.getLang("iconize_mce.insert_icon_title"),cmd:"insertIcon",image:n+"/images/flag.png"});t.addButton("swap_icon_positions",{title:t.getLang("iconize_mce.swap_pos_title"),cmd:"swapIconsPositions",image:n+"/images/swappos.png"});t.addButton("swap_icon_sizes",{title:t.getLang("iconize_mce.swap_size_title"),cmd:"swapIconsSizes",image:n+"/images/swapsizes.png"});t.addButton("remove_icon",{title:t.getLang("iconize_mce.remove_icon_title"),cmd:"removeIcon",image:n+"/images/unflag.png"});r._handlePlaceholder(t);t.onNodeChange.add(function(e,t,n){if("SPAN"===n.nodeName&&e.dom.hasClass(n,"iconized-placeholder")){r._selectIcon(e,n)}t.setActive("insert_icon",e.dom.getParent(n,".iconized")&&!e.selection.isCollapsed());t.setDisabled("swap_icon_positions",!(e.dom.getParent(n,".iconized")&&e.dom.getParent(n,".iconized-stack")&&(e.dom.getPrev(n,".iconized")||e.dom.getPrev(n.parentNode,".iconized")||e.dom.getNext(n,".iconized")||e.dom.getNext(n.parentNode,".iconized"))));t.setDisabled("swap_icon_sizes",!(e.dom.getParent(n,".iconized")&&e.dom.getParent(n,".iconized-stack")&&(e.dom.getPrev(n,".iconized")||e.dom.getPrev(n.parentNode,".iconized")||e.dom.getNext(n,".iconized")||e.dom.getNext(n.parentNode,".iconized"))));t.setDisabled("remove_icon",!(e.dom.getParent(n,".iconized")&&!e.selection.isCollapsed()))})},getInfo:function(){return{longname:"Iconize WordPress Plugin",author:"Mladen Ivancevic",authorurl:"http://codecanyon.net/user/mladen16/",infourl:"http://codecanyon.net/user/mladen16/",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_selectIcon:function(t,n){if(t.dom.hasClass(n,"iconized-placeholder")){if(tinymce.isWebKit){e(n.parentNode).removeAttr("contenteditable");t.selection.select(n.parentNode);e(n.parentNode).attr({contenteditable:false})}else{t.selection.select(n.parentNode)}}else{t.selection.select(n)}},_handlePlaceholder:function(t){t.onPostRender.add(function(){if(t.theme.onResolveName){t.theme.onResolveName.add(function(e,n){if(t.dom.hasClass(n.node,"iconized")){n.name=t.selection.isCollapsed()?null:"iconized"}else if(t.dom.hasClass(n.node,"iconized-stack")){n.name=t.selection.isCollapsed()?null:"iconized-stack"}})}});t.onBeforeSetContent.add(function(t,n){if(n.content){var r=e("<div></div>");r.html(n.content);e(r).find(".iconized").each(function(){var t=e(this);if(t.parent(".iconized-stack")){t.parent(".iconized-stack").attr("contenteditable","false").addClass("mceItemNoResize");t.empty().addClass("mceItemNoResize").append('<span class="iconized-placeholder mceItemHidden mceItemNoResize">|icon|</span>')}else{t.empty().attr("contenteditable","false").addClass("mceItemNoResize").append('<span class="iconized-placeholder mceItemHidden mceItemNoResize">|icon|</span>')}});var i=e(r).html();n.content=i;e(r).remove()}});t.onPostProcess.add(function(t,n){if(n.get){var r=e("<div></div>");r.html(n.content);e(r).find(".iconized").each(function(){var t=e(this);if(t.parent(".iconized-stack")){t.parent(".iconized-stack").removeAttr("contenteditable")}t.empty().removeAttr("contenteditable")});var i=e(r).html();n.content=i;e(r).remove()}})}});tinymce.PluginManager.add("iconize_mce",tinymce.plugins.IconizePlugin)})(jQuery)