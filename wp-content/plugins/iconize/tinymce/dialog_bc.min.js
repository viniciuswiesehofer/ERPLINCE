var iconizeTinymceDialog;(function(e){"use strict";var t,n,r,i,s,o,u,a,f,l={},c=[],h="",p=[],d="",v=[],m=[],g=[],y=[],b=[],w=[],E=[],S=[],x=[],T=[],N=["iconized","mceItemNoResize","iconized-stack-base"],C=["iconized-stack"],k="hover-color-change";iconizeTinymceDialog={textarea:"",init:function(){l.dialog=e("#iconize-mce-modal");l.submit=e("#iconize-mce-update");l.stack=e("#iconize-mce-stack");l.set=e("#mce-icon-set");l.name=e("#mce-icon-name");l.effect=e("#mce-icon-effect");l.transform=e("#mce-icon-transform");l.animate=e("#mce-icon-animate");l.hover=e("#mce-icon-hover");l.color=e("#mce-icon-color");l.hovercolor=e("#mce-icon-color-hover");l.size=e("#mce-icon-size");l.customsize=e("#mce-icon-custom-size");l.align=e("#mce-icon-align");l.custom=e("#mce-icon-custom-classes");s=e("#iconize-mce-icons");o=e("#iconize-mce-title");u=e("#mce-icon-size-howto");a=e("#mce-icon-align-howto");f=e("#mce-color-hover-checkbox");y=iconizeTinymceDialog.getSelectOptions(l.set);S=iconizeTinymceDialog.getSelectOptions(l.transform);x=iconizeTinymceDialog.getSelectOptions(l.animate);T=iconizeTinymceDialog.getSelectOptions(l.hover);w=iconizeTinymceDialog.getSelectOptions(l.size);E=iconizeTinymceDialog.getSelectOptions(l.align);g=iconizeTinymceDialog.getSelectOptions(l.effect);if(iconizeDialogParams.icons){for(var t=0;t<y.length;t++){var n=y[t],r=iconizeDialogParams.icons[n],i=e('<ul id="'+n+'-icons-list">').addClass("icons-list");s.append(i);e.merge(m,r);for(var h=0;h<r.length;h++){var p=r[h],d="glyph-"+p,v;v='<li class="icons-list-item">';v+='<a href="#" class="icons-list-icon" title="'+p+'" data-set="'+n+'">';v+='<span class="iconized '+n+" "+d+'"></span>';v+="</a>";v+="</li>";i.append(v);c.push({label:p,set:n});b.push(d)}}}C.push(k);e.merge(C,N);e.merge(C,b);e.merge(C,y);e.merge(C,S);e.merge(C,x);e.merge(C,T);e.merge(C,w);e.merge(C,E);l.set.change(function(){var t=e(this).val(),n="#"+t+"-icons-list";s.find(".icons-list").hide();s.find(n).show();s.scrollTop(0)});l.name.iconizeautocomplete({appendTo:l.dialog,source:c,minLength:1,change:function(t,n){if(null===n.item){var r=s.find(".selected-icon"),i=r.attr("title"),o=r.data("set");if(r.length){e(this).val(i);l.set.val(o)}else{e(this).val("");l.set.val(y[0])}}},select:function(e,t){iconizeTinymceDialog.unselectIcon();iconizeTinymceDialog.selectIcon(t.item.set,t.item.value);iconizeTinymceDialog.scrollToIcon()}}).bind("focus",function(){e(this).iconizeautocomplete("search")});l.color.wpColorPicker({change:function(){iconizeTinymceDialog.setColor(e(this).wpColorPicker("color"));f.removeClass("hidden")},clear:function(){iconizeTinymceDialog.setColor("");f.addClass("hidden")}});l.custom.tagit({autocomplete:{disabled:true},preprocessTag:function(e){if(!e){return""}var t=e.replace(/^[^-_a-zA-Z]+/,"").replace(/^-(?:[-0-9]+)/,"-");var n=t&&t.replace(/[^-_a-zA-Z0-9]+/g,"-");return n},afterTagAdded:function(t,n){if(e.inArray(n.tagLabel,C)!==-1){alert(iconizeDialogParams.l10n.reserved_class);l.custom.tagit("removeTag",n.tag)}}});l.submit.click(function(e){e.preventDefault();iconizeTinymceDialog.update()});l.stack.click(function(e){e.preventDefault();iconizeTinymceDialog.stack()});e("#iconize-mce-modal .icons-list-icon").click(function(t){t.preventDefault();var n=e(this);if(false===n.hasClass("selected-icon")){s.find(".icons-list-icon.selected-icon").removeClass("selected-icon");n.addClass("selected-icon");l.name.val(n.attr("title"))}});l.dialog.on("show.wpbs.modal",iconizeTinymceDialog.refresh);l.dialog.on("shown.wpbs.modal",function(){iconizeTinymceDialog.scrollToIcon(true)});l.dialog.on("hide.wpbs.modal",iconizeTinymceDialog.onClose);l.dialog.on("hidden.wpbs.modal",iconizeTinymceDialog.setDefaultValues);if(typeof fullscreen!=="undefined"){fullscreen.insertIcon=function(){if(iconizeTinymceDialog.isMCE()){tinyMCE.execCommand("insertIcon")}else{iconizeTinymceDialog.open()}}}if(iconizeSettings.iconizeQuicktags&&typeof QTags!=="undefined"){QTags.addButton("icon","icon",function(){iconizeTinymceDialog.open()},"","",iconizeDialogParams.l10n.insert,130)}},isMCE:function(){if("wp_mce_fullscreen"===wpActiveEditor){return e("#wp-fullscreen-mode-bar").hasClass("wp-tmce-mode")}else{return tinyMCEPopup&&(t=tinyMCEPopup.editor)&&!t.isHidden()}},open:function(){if(!wpActiveEditor){return}iconizeTinymceDialog.textarea=e("#"+wpActiveEditor).get(0);l.dialog.wpbsmodal("show")},refresh:function(){if(!b.length){alert(iconizeDialogParams.l10n.no_icons_defined);return false}s.addClass("loading-overlay");if(iconizeTinymceDialog.isMCE()){iconizeTinymceDialog.mceRefresh()}else{iconizeTinymceDialog.range=null;if(document.selection){iconizeTinymceDialog.textarea.focus();iconizeTinymceDialog.range=document.selection.createRange()}iconizeTinymceDialog.setDefaultValues()}},mceRefresh:function(){var n,s,c="",m="",C="",L="",A="",O="",M="",_="",D="",P="",H="",B="",j=false;t=tinyMCEPopup.editor;tinyMCEPopup.restoreSelection();c=t.selection.getNode();r=t.dom.hasClass(c,"iconized");i=t.dom.getParent(c,"span.iconized-stack");if(r){o.text(iconizeDialogParams.l10n.edit);if(i){l.stack.hide();u.text(iconizeDialogParams.l10n.stack_size_label);a.text(iconizeDialogParams.l10n.stack_align_label);d=t.dom.getAttrib(i,"class");v=d.split(/ /);for(n=0;n<v.length;n++){if(e.inArray(v[n],w)!==-1){A=v[n]}if(e.inArray(v[n],E)!==-1){M=v[n]}}if(t.dom.getStyle(i,"font-size")){O=t.dom.getStyle(i,"font-size")}}else{l.stack.show();u.text(iconizeDialogParams.l10n.icon_size_label);a.text(iconizeDialogParams.l10n.icon_align_label)}h=t.dom.getAttrib(c,"class");p=h.split(/ /);for(n=0;n<N.length;n++){s=e.inArray(N[n],p);if(s!==-1){p.splice(s,1)}}for(n=0;n<p.length;n++){if(e.inArray(p[n],y)!==-1){m=p[n]}else if(e.inArray(p[n],b)!==-1){C=p[n]}else if(!i&&e.inArray(p[n],w)!==-1){A=p[n]}else if(!i&&e.inArray(p[n],E)!==-1){M=p[n]}else if(e.inArray(p[n],S)!==-1){D=p[n];_="transform"}else if(e.inArray(p[n],x)!==-1){P=p[n];_="animate"}else if(e.inArray(p[n],T)!==-1){H=p[n];_="hover"}else if(k===p[n]){j=true}else{l.custom.tagit("createTag",p[n])}}if(C&&m){L=C.replace("glyph-","");iconizeTinymceDialog.selectIcon(m,L);l.transform.val(D);l.animate.val(P);l.hover.val(H);if(_){l.effect.val(_)}else{l.effect.val(g[0])}iconizeTinymceDialog.showChildOptions(l.effect);if(t.dom.getStyle(c,"font-size")){O=t.dom.getStyle(c,"font-size")}if(O){l.size.val("custom-size");l.customsize.val(O)}else{l.size.val(A);l.customsize.val("")}iconizeTinymceDialog.showChildOptions(l.size);l.align.val(M);if(t.dom.getStyle(c,"color")){B=t.dom.getStyle(c,"color");f.removeClass("hidden")}else{B="";f.addClass("hidden")}l.color.val(B);l.color.wpColorPicker("color",B);l.hovercolor.prop("checked",j);l.submit.text(iconizeDialogParams.l10n.update)}else{alert(iconizeDialogParams.l10n.no_icon_found);iconizeTinymceDialog.setDefaultValues()}}else{iconizeTinymceDialog.setDefaultValues()}tinyMCEPopup.storeSelection()},close:function(){if(iconizeTinymceDialog.isMCE()){tinyMCEPopup.close()}else{l.dialog.wpbsmodal("hide")}},onClose:function(){if(!iconizeTinymceDialog.isMCE()){iconizeTinymceDialog.textarea.focus();if(iconizeTinymceDialog.range){iconizeTinymceDialog.range.moveToBookmark(iconizeTinymceDialog.range.getBookmark());iconizeTinymceDialog.range.select()}}},update:function(){if(iconizeTinymceDialog.isMCE()){iconizeTinymceDialog.mceUpdate()}else{iconizeTinymceDialog.htmlUpdate()}},htmlUpdate:function(){var e,t,n,r=iconizeTinymceDialog.textarea,i="",s="",o="",u="",a="",f="",c="",h="",p="",d="",v="",m="";if(!r){return}s=l.name.val();if(!s){alert(iconizeDialogParams.l10n.no_icon_selected)}else{i=l.set.val();o=l.size.val();u=l.customsize.val();a=l.align.val();f=l.effect.val();h=l.color.val();p=l.hovercolor.prop("checked");d=l.custom.tagit("assignedTags");d=d.toString();d=d.replace(/,/g," ");if("transform"===f){c=l.transform.val()}else if("animate"===f){c=l.animate.val()}else if("hover"===f){c=l.hover.val()}if(h||"custom-size"===o){m=' style="';m+=h?"color:"+h+";":"";m+=u?"font-size:"+u+";":"";m+='"'}v='<span class="iconized '+i+" glyph-"+s;v+=o&&"custom-size"!==o?" "+o:"";v+=a?" "+a:"";v+=c?" "+c:"";v+=h&&p?" "+k:"";v+=d?" "+d:"";v+='"';v+=m;v+="></span>";if(document.selection&&iconizeTinymceDialog.range){r.focus();iconizeTinymceDialog.range.text=v;iconizeTinymceDialog.range.moveToBookmark(iconizeTinymceDialog.range.getBookmark());iconizeTinymceDialog.range.select();iconizeTinymceDialog.range=null}else if(typeof r.selectionStart!=="undefined"){e=r.selectionStart;t=r.selectionEnd;n=e+v.length;r.value=r.value.substring(0,e)+v+r.value.substring(t,r.value.length);r.selectionStart=r.selectionEnd=n}iconizeTinymceDialog.close();r.focus()}},mceUpdate:function(t){var s,o,u=[],a="",f="",c="",m="",g="",y="",b="",S="",x="",T="",C="",L="";t=tinyMCEPopup.editor;if(tinymce.isIE){t.selection.moveToBookmark(t.updatedSelectionBookmark)}tinyMCEPopup.restoreSelection();f=l.name.val();if(!f){alert(iconizeDialogParams.l10n.no_icon_selected)}else{a=l.set.val();c=l.size.val();m=l.customsize.val();g=l.align.val();y=l.effect.val();S=l.color.val();x=l.hovercolor.prop("checked");T=l.custom.tagit("assignedTags");T=T.toString();T=T.replace(/,/g," ");if("transform"===y){b=l.transform.val()}else if("animate"===y){b=l.animate.val()}else if("hover"===y){b=l.hover.val()}n=t.selection.getNode();r=t.dom.hasClass(n,"iconized");i=t.dom.getParent(n,"span.iconized-stack");h=t.dom.getAttrib(n,"class");p=h.split(/ /);for(s=0;s<N.length;s++){o=e.inArray(N[s],p);if(o!==-1){u.push(N[s])}}if(r){if(i){d=t.dom.getAttrib(i,"class");v=d.split(/ /);for(s=0;s<v.length;s++){if(e.inArray(v[s],w)!==-1){t.dom.removeClass(i,v[s])}else if(e.inArray(v[s],E)!==-1){t.dom.removeClass(i,v[s])}}e(i).removeAttr("data-mce-style")}e(n).removeAttr("class");e(n).removeAttr("data-mce-style");for(s=0;s<u.length;s++){t.dom.addClass(n,u[s])}t.dom.addClass(n,a);t.dom.addClass(n,"glyph-"+f);if(i){if("custom-size"===c){t.dom.setStyles(i,{"font-size":m})}else{t.dom.setStyles(i,{"font-size":""});t.dom.addClass(i,c)}if(g){t.dom.addClass(i,g)}}else{if("custom-size"===c){t.dom.setStyles(n,{"font-size":m})}else{t.dom.setStyles(n,{"font-size":""});t.dom.addClass(n,c)}if(g){t.dom.addClass(n,g)}}if(b){t.dom.addClass(n,b)}if(T){t.dom.addClass(n,T)}if(S&&x){t.dom.addClass(n,k)}t.dom.setStyles(n,{color:S})}else{L="iconized mceItemNoResize "+a+" glyph-"+f;L+=c&&"custom-size"!==c?" "+c:"";L+=g?" "+g:"";L+=b?" "+b:"";L+=T?" "+T:"";C=t.dom.create("span",{"class":L,contenteditable:"false"},'<span class="iconized-placeholder mceItemHidden mceItemNoResize">|icon|</span>');if("custom-size"===c){t.dom.setStyle(C,"font-size",m)}if(S){t.dom.setStyle(C,"color",S);if(x){t.dom.addClass(C,k)}}t.selection.setNode(C)}tinyMCEPopup.storeSelection();iconizeTinymceDialog.close();t.focus()}},stack:function(){var r,i="",s="",o="",u="",a="",f="",c="",d="",v="",m="",g="",y="",b="",S="";t=tinyMCEPopup.editor;tinyMCEPopup.restoreSelection();i=l.set.val();s=l.name.val();o=l.size.val();u=l.customsize.val();a=l.align.val();f=l.effect.val();d=l.color.val();v=l.hovercolor.prop("checked");m=l.custom.tagit("assignedTags");m=m.toString();m=m.replace(/,/g," ");if("transform"===f){c=l.transform.val()}else if("animate"===f){c=l.animate.val()}else if("hover"===f){c=l.hover.val()}n=t.selection.getNode();h=t.dom.getAttrib(n,"class");p=h.split(/ /);for(r=0;r<p.length;r++){if(e.inArray(p[r],w)!==-1){t.dom.removeClass(n,p[r])}else if(e.inArray(p[r],E)!==-1){t.dom.removeClass(n,p[r])}if(t.dom.getStyle(n,"font-size")){b=t.dom.getStyle(n,"font-size")}}t.dom.addClass(n,"iconized-stack-base");y='<span contenteditable="false" class="iconized-stack';y+=o&&"custom-size"!==o?" "+o:"";y+=a?" "+a:"";y+='"/>';e(n).wrap(y).parent().css("font-size",b);S="iconized mceItemNoResize "+i+" glyph-"+s;S+=c?" "+c:"";S+=m?" "+m:"";g=t.dom.create("span",{"class":S,contenteditable:"false"},'<span class="iconized-placeholder mceItemHidden mceItemNoResize">|icon|</span>');if(d){t.dom.setStyle(g,"color",d);if(v){t.dom.addClass(g,k)}}t.dom.insertAfter(g,n);t.selection.setCursorLocation(g,0);tinyMCEPopup.storeSelection();iconizeTinymceDialog.close()},setDefaultValues:function(){iconizeTinymceDialog.unselectIcon();iconizeTinymceDialog.clearColorPicker();iconizeTinymceDialog.clearCustomClasses();l.stack.hide();l.effect.val(g[0]);l.transform.val("");l.animate.val("");l.hover.val("");iconizeTinymceDialog.showChildOptions(l.effect);l.size.val("");l.customsize.val("");iconizeTinymceDialog.showChildOptions(l.size);l.align.val("");l.color.val("");l.hovercolor.prop("checked",false);f.addClass("hidden");o.text(iconizeDialogParams.l10n.insert);u.text(iconizeDialogParams.l10n.icon_size_label);a.text(iconizeDialogParams.l10n.icon_align_label);l.submit.text(iconizeDialogParams.l10n.insert)},selectIcon:function(e,t){l.set.val(e);s.find(".icons-list").hide();s.find("#"+e+"-icons-list").show();var n="."+e+".glyph-"+t;s.find(n).parent().addClass("selected-icon");l.name.val(t)},unselectIcon:function(){s.find(".icons-list-icon.selected-icon").removeClass("selected-icon");l.name.val("");l.set.val(y[0]);s.find(".icons-list").hide();s.find("#"+y[0]+"-icons-list").show()},setColor:function(e){l.color.val(e)},clearColorPicker:function(){l.color.wpColorPicker("color","");e("#iconize-mce-modal .wp-color-result").removeAttr("style")},clearCustomClasses:function(){l.custom.tagit("removeAll")},scrollToIcon:function(e){var t=e||false,n="",r=0;n=l.dialog.find(".selected-icon");if(n.length){r=n.position().top-s.position().top+s.scrollTop()-92}if(true===t){s.animate({scrollTop:r},"500","swing",function(){s.removeClass("loading-overlay")})}else{s.scrollTop(r)}},getSelectOptions:function(t){var n=[];t.find("option").each(function(){var t=e(this).val();n.push(t)});return n},showChildOptions:function(t){var n=t,r=n.val(),i=n.attr("id"),s=".mother-opt-"+i,o=".mother-val-"+r;e(s).addClass("hidden");e(s+o).removeClass("hidden")}};e(document).ready(iconizeTinymceDialog.init)})(jQuery)